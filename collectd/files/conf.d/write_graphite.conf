{%- from "linux/map.jinja" import system with context %}

LoadPlugin write_graphite
{%- for plugin in pillar.collectd.client.plugins %}
{%- if plugin_name == plugin.name %}
<Plugin write_graphite>
	<Carbon>
		Host "{{ plugin.host }}"
		Port "{{ plugin.port }}"
		Prefix "{{ system.cluster }}_{{ system.environment }}."
		Postfix ""
		StoreRates false
		AlwaysAppendDS false
		EscapeCharacter "_"
		SeparateInstances true
		Protocol "{{ plugin.get('protocol', 'tcp') }}"
	</Carbon>
</Plugin>
{%- endif %}
{%- endfor %}
