{%- if pillar.get('external', {}).network_device is defined %}
LoadPlugin snmp

<Plugin snmp>
  <Data "std_traffic">
    Type "if_octets"
    Table true
    Instance "1.3.6.1.2.1.31.1.1.1.1"
    Values "1.3.6.1.2.1.31.1.1.1.6" "1.3.6.1.2.1.31.1.1.1.10"
  </Data>
  <Data "std_rate">
    Type "if_packets"
    Table true
    Instance "1.3.6.1.2.1.31.1.1.1.1"
    Values "1.3.6.1.2.1.31.1.1.1.7" "1.3.6.1.2.1.31.1.1.1.11"
  </Data>
  {%- for device_name, device in pillar.external.network_device.iteritems() %}       
  <Host "{{ device_name }}">
    Address "{{ device.management.address }}"
    Version {{ device.get('version', '2') }}
    Community "{{ device.community }}"
    Collect "std_traffic" "std_rate"
  </Host>
  {%- endfor %}
</Plugin>
{%- endif %}