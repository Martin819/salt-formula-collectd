{%- from "linux/map.jinja" import system with context %}
{%- set backend = salt['pillar.get']('collectd:client:backend:'+backend_name) %}

LoadPlugin write_graphite

<Plugin write_graphite>
	<Carbon>
		Host "{{ backend.host }}"
		Port "{{ backend.port }}"
		Prefix "{{ system.get('cluster', 'prd') }}_{{ system.get('environment', 'prd') }}."
		Postfix ""
		StoreRates false
		AlwaysAppendDS false
		EscapeCharacter "_"
		SeparateInstances true
		Protocol "{{ backend.get('protocol', 'tcp') }}"
	</Carbon>
</Plugin>
